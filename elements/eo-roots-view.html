<link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<link rel="import" href="expand-button.html">
<link rel="import" href="EOReplacementBehavior.html">

<dom-module id="eo-roots-view">
  <template>
    <style>
      :host {
        display: block;
      }

      h2 {
        margin-bottom: var(--heading-margin);
      }

      expand-button {
        --button-height: 1.5em;
      }

      button {
        margin-left: 1em;
      }

      ul {
        column-width: 7em;
        list-style-type: none;
        padding-left: 0;
      }

      iron-icon {
        width: 1.2em;
        height: 1.2em;
        padding: 0.3em;
        cursor: pointer;
      }
    </style>

    <h2>
      Roots
      <expand-button expanded={{!hidden}}></expand-button>
    </h2>
    <div hidden$="{{hidden}}">
      <paper-input
        eo-replace
        id="input"
        label="Add a root"
        always-float-label>
      </paper-input>
      <iron-a11y-keys
        target="[[_input]]"
        keys="enter"
        on-keys-pressed="_pushWord">
      </iron-a11y-keys>
      <ul>
        <template id="repeater" is="dom-repeat" items="{{_toArray(words)}}" as="word" sort="_sort">
          <li>
            <iron-icon icon="icons:clear" on-tap="_deleteWord">delete</iron-icon>
            {{word.word}}
          </li>
        </template>
      </ul>
    </div>
  </template>

  <script>
    Polymer({
      is: 'eo-roots-view',

      behaviors: [ EOReplacementBehavior ],

      properties: {
        words: {
          notify: true
        }
      },

      get _input() {
        return this.$.input;
      },

      _toArray: function(obj) {
        let arr = [];
        for (key of Object.keys(obj)) {
          let item = { word: key };
          if (obj[key].constructor === Object)
            Object.assign(item, obj[key]);
          arr.push(item);
        }
        return arr;
      },

      _pushWord: function(e) {
        this.words[this.$.input.value.trim()] = true;

        // force data system to notice that we added a word
        // https://www.polymer-project.org/1.0/docs/devguide/model-data#override-dirty-check
        let words = this.words; this.words = {}; this.words = words;

        this.$.input.value = '';
      },

      _deleteWord: function(e) {
        delete this.words[this.$.repeater.itemForElement(e.target).word];

        // force data system to notice that we deleted a word
        let words = this.words; this.words = {}; this.words = words;

        this.$.input.focus();
      },

      _sort: function(a, b) {
        return a.word.localeCompare(b.word);
      }
    });
  </script>
</dom-module>
