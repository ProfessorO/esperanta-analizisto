<dom-module id="eo-results">
  <template>

    <h2>Results</h2>
    <div id="show"></div>

  </template>

  <script>
    Polymer({
      is: 'eo-results',

      properties: {
        results: {
          observer: '_show'
        },

        _colorArray: {
          value: [
            '#a6cee3',
            '#b2df8a',
            '#fb9a99',
            '#33a02c',
            '#fdbf6f',
            '#cab2d6',
            '#ffff99'
          ]
        },

        _currentColorIndex: {
          value: -1
        }
      },

      _show: function() {
        let show = this.$.show;
        while (show.lastChild)
          show.removeChild(show.lastChild);

        for (let token of this.results) {
          if (!token.roots.length) {
            this._newSpan(token.token, false);
          } else {
            token.roots.forEach(token => this._newSpan(token, true));
            if (token.token != token.roots.join('')) {
              this._newSpan(token.token.substr(token.roots.join('').length), false);
            }
          }
        }
      },

      _newSpan: function(token, isRoot) {
        let span = document.createElement('span');

        if (isRoot) {
          span.classList.add('root');
          span.style.backgroundColor = this._nextColor();
        }

        span.textContent = token;

        this.$.show.appendChild(span);
      },

      _nextColor: function() {
        if (this._currentColorIndex < this._colorArray.length - 1)
          this._currentColorIndex++;
        else
          this._currentColorIndex = 0;
        return this._colorArray[this._currentColorIndex];
      }
    });
  </script>
</dom-module>
