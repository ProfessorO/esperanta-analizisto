<dom-module id="eo-parser">
  <script>
    Polymer({
      is: 'eo-parser',

      properties: {
        words: Array,

        input: String,

        results: {
          notify: true
        },

        _wordRegex: {
          value: /[ABCĈDEFGĜHĤIJĴKLMNOPRSŜTUŬVZabcĉdefgĝhĥijĵklmnoprsŝtuŭvz]+/g
        }
      },

      observers: [
        'analyze(words, input)'
      ],

      analyze: function() {
        if (this.words.length > 0) {
          let info = {};

          info.wordlist = this.input.match(this._wordRegex);
          info.rootlist = info.wordlist.map(this._splitWord, this);
          info.zipped = info.wordlist.map((_, index) =>
            ({word: info.wordlist[index], roots: info.rootlist[index]})
          );

          this.results = info;
        }
      },

      _splitWord: function(word) {
        if (word.length == 0)
          return [];
        for (let end = word.length; end > 0; end--) {
          let possibleRoot = word.slice(0, end);
          let wordArray = this.words.map(entry => entry.word);
          if (wordArray.includes(possibleRoot))
            return [possibleRoot, ...this._splitWord(word.slice(end))];
          else if (wordArray.includes(possibleRoot.toLowerCase()))
            return [possibleRoot.toLowerCase(), ...this._splitWord(word.slice(end))];
        }
        return [word];
      }
    });
  </script>
</dom-module>
